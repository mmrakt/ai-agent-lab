---
description: "ローカル git diff を元にコードレビューを実行する"
agent: "code-review"
tools: ["execute/runInTerminal", "search/codebase", "search/changes"]
---

# ローカル diff レビューを実行する

`.github/agents/code-review.agent.md` の **モード B: ローカルレビュー（ワークスペース直接参照）** に従い、ローカルの git diff をレビューしてください。

## 入力

ユーザーが以下のいずれかを指定する:

- **比較対象ブランチ**（例: `main との差分をレビューして`）— 未指定の場合はデフォルトブランチ（`main`）との差分を使用する。
- **特定のファイル/ディレクトリ**（例: `apps/api の差分をレビューして`）— 指定があれば対象を絞る。
- **ステージング済み差分のみ**（例: `staged をレビューして`）— `git diff --cached` を使用する。

## 実行手順

1. `git diff <比較対象>` を実行し、差分を取得する。対象ブランチが指定されていなければ `git diff main...HEAD` を使用する。ステージング指定なら `git diff --cached` を使用する。
2. `git diff --stat <比較対象>` で変更ファイル一覧と変更量を把握する。
3. 変更が `apps/api` か `apps/web` かを判別し、該当するリファレンスドキュメントを読み込む。
4. diff だけで判断せず、**ワークスペースの実ファイル**（スキーマ・型定義・呼び出し元）を読んで文脈を把握する。
5. エージェント定義の全レビュー観点（アーキテクチャ〜パフォーマンス）に沿ってチェックする。
6. `pnpm check` を実行し、lint / typecheck 違反がないか確認する。
7. レビュー結果をエージェント定義の出力フォーマット（サマリ本文）に従い、チャットに出力する。

## 注意事項

- コメント形式・サマリフォーマットは `.github/agents/code-review.agent.md` の定義に従うこと。
- 修正案は具体的なコードスニペットを必ず含める。
- YAGNI を意識し、「今」修正すべきか「将来」の課題かを区別する。
- レビューの最後に全体の総評（品質評価・優先修正項目）を 2〜3 文で記載する。
